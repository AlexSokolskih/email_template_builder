(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1287:function(e,t,n){Promise.resolve().then(n.bind(n,256))},256:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var a=n(7437),s=n(2265),o=n(1396),l=n.n(o),r=n(837),i=n(2455),c=n(9409),d=n(3691),m=n(3302),h=n(1541),u=n(8438),x=n(5432),p=n(5817),g=n(9670),f=n(3966),y=n(2549),b=n(1942),v=n(6020),j=n(4266),w=n(1628);let N={html:'<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Email Template</title>\n</head>\n<body style="margin: 0; padding: 0; font-family: Arial, sans-serif;">\n    <div class="email-container" style="max-width: 600px; margin: 0 auto; background-color: #ffffff;">\n        <header style="background-color: #4f46e5; color: white; padding: 20px; text-align: center;">\n            <h1 style="margin: 0; font-size: 24px;">Your Company</h1>\n        </header>\n        \n        <main style="padding: 30px 20px;">\n            <h2 style="color: #1f2937; margin-bottom: 20px;">Welcome!</h2>\n            <p style="color: #4b5563; line-height: 1.6; margin-bottom: 20px;">\n                This is a sample email template. You can edit the HTML and CSS to create your own design.\n            </p>\n            <div style="text-align: center; margin: 30px 0;">\n                <a href="#" style="background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">\n                    Call to Action\n                </a>\n            </div>\n        </main>\n        \n        <footer style="background-color: #f3f4f6; padding: 20px; text-align: center; color: #6b7280;">\n            <p style="margin: 0;">\xa9 2024 Your Company. All rights reserved.</p>\n        </footer>\n    </div>\n</body>\n</html>',css:"/* Email CSS Styles */\n.email-container {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n}\n\n.email-container h1 {\n    font-size: 24px;\n    font-weight: bold;\n    margin: 0;\n}\n\n.email-container h2 {\n    font-size: 20px;\n    font-weight: 600;\n    margin-bottom: 15px;\n}\n\n.email-container p {\n    margin-bottom: 15px;\n}\n\n.email-container a {\n    text-decoration: none;\n    color: #4f46e5;\n}\n\n.email-container a:hover {\n    text-decoration: underline;\n}\n\n/* Responsive design */\n@media (max-width: 600px) {\n    .email-container {\n        width: 100% !important;\n    }\n    \n    .email-container main {\n        padding: 20px 15px !important;\n    }\n}"};function EmailEditor(){let[e,t]=(0,s.useState)(N),[n,o]=(0,s.useState)("html"),[l,k]=(0,s.useState)("desktop"),[S,C]=(0,s.useState)("preview"),[E,T]=(0,s.useState)([{id:"1",role:"assistant",content:"Привет! Я помогу тебе создать email шаблон. Что хочешь изменить?",timestamp:new Date}]),[D,I]=(0,s.useState)(""),[L,O]=(0,s.useState)(!1),[R,U]=(0,s.useState)(!1),[Z,A]=(0,s.useState)(!1),[F,P]=(0,s.useState)([]),z=(0,s.useRef)(null),M=(0,s.useRef)(null),B=(0,s.useRef)(null),H=(0,s.useRef)(null),J=(0,s.useRef)(null),Y=(0,s.useRef)(null),[_,K]=(0,s.useState)([]),loadUserFiles=async()=>{let e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user")||"{}"),n=t.id;if(!e||!n){console.log("Пользователь не авторизован, пропускаем загрузку файлов");return}try{let t=await fetch("".concat((0,w.l)(),"/api/upload/"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();e.files&&P(e.files)}}catch(e){console.error("Ошибка загрузки списка файлов:",e)}},replaceRelativePaths=e=>{let t=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user")||"{}"),a=n.id,s=(0,w.l)(),o=t?"?token=".concat(encodeURIComponent(t)):"";return e.replace(/src="(?!https?:\/\/)([^"]*\.(png|jpg|jpeg|gif|svg|webp|ico|woff|woff2|ttf|otf|eot))"/gi,'src="'.concat(s,"/api/assets/").concat(a,"/$1").concat(o,'"'))},updatePreview=()=>{if(z.current){var t;let n=z.current,a=n.contentDocument||(null===(t=n.contentWindow)||void 0===t?void 0:t.document);if(a){let t=replaceRelativePaths(e.html);a.open(),a.write('\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset="utf-8">\n            <meta name="viewport" content="width='.concat("mobile"===l?"375":"device-width",', initial-scale=1.0, user-scalable=no">\n            <style>').concat(e.css,"</style>\n          </head>\n          <body>\n            ").concat(t,"\n          </body>\n          </html>\n        ")),a.close()}}};(0,s.useEffect)(()=>{updatePreview()},[e]),(0,s.useEffect)(()=>{(()=>{let e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user")||"{}");console.log("Проверка авторизации при загрузке EmailEditor:"),console.log("- Токен:",e?"присутствует":"отсутствует"),console.log("- Пользователь:",t),e&&t.id?console.log("Пользователь авторизован:",t.email):console.warn("Пользователь не авторизован!")})()},[]),(0,s.useEffect)(()=>{loadUserFiles()},[]),(0,s.useEffect)(()=>{"preview"===S&&setTimeout(()=>{updatePreview()},100)},[S]);let handleEditorChange=(e,n)=>{void 0!==e&&t(t=>({...t,["html"===n?"html":"css"]:e}))},uploadAssets=()=>{var e;null===(e=B.current)||void 0===e||e.click()},handleAssetsUpload=async e=>{let t=e.target.files;if(t&&0!==t.length){A(!0);try{var n;let e=localStorage.getItem("token");if(!e)throw Error("Необходима авторизация. Пожалуйста, войдите в систему.");let a=Array.from(t).map(async t=>{var n;if(t.size>10485760)throw Error("Файл ".concat(t.name," слишком большой. Максимальный размер: 10MB"));let a=null===(n=t.name.split(".").pop())||void 0===n?void 0:n.toLowerCase(),s=["png","jpg","jpeg","gif","webp","svg","pdf","txt","html","css","js","json","xml","mp4","mp3","wav"];if(!a||!s.includes(a))throw Error("Неподдерживаемый тип файла: ".concat(t.name,". Поддерживаемые типы: ").concat(s.join(", ")));let o=new FormData;o.append("file",t);let l=await fetch("".concat((0,w.l)(),"/api/upload/"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:o});if(!l.ok){let e="Ошибка загрузки файла ".concat(t.name);401===l.status?e="Необходима авторизация. Пожалуйста, войдите в систему.":403===l.status?e="Доступ запрещен":400===l.status?e="Некорректный запрос":413===l.status?e="Файл слишком большой":500===l.status&&(e="Ошибка сервера при загрузке файла");try{let t=await l.json();e=t.error||e}catch(e){}throw Error(e)}let r=await l.json();return{filename:t.name,uploadedFile:r.uploadedFile,folder:r.folder,files:r.files}}),s=await Promise.all(a);console.log("Успешно загружено ".concat(s.length," файлов:"),s),s.length>0&&P(s[s.length-1].files);let o=s.map(e=>e.filename).join(", ");alert("Успешно загружено ".concat(s.length," файлов:\n").concat(o,"\n\nПапка: ").concat(null===(n=s[0])||void 0===n?void 0:n.folder))}catch(e){console.error("Error uploading assets:",e),alert("Ошибка при загрузке файлов: ".concat(e instanceof Error?e.message:"Неизвестная ошибка"))}finally{A(!1),e.target.value=""}}},handleChatFilesSelect=async e=>{let t=e.target.files;if(t&&0!==t.length)try{let e=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user")||"{}"),a=n.id||"default";if(!e)throw Error("Необходима авторизация. Пожалуйста, войдите в систему.");let s=await Promise.all(Array.from(t).map(async t=>{if(t.size>10485760)throw Error("Файл ".concat(t.name," слишком большой. Максимальный размер: 10MB"));let n=new FormData;n.append("file",t);let s=await fetch("".concat((0,w.l)(),"/api/upload/"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:n});if(!s.ok)throw Error("Ошибка загрузки файла ".concat(t.name));let o=e?"?token=".concat(encodeURIComponent(e)):"",l="".concat((0,w.l)(),"/api/assets/").concat(a,"/").concat(t.name).concat(o);return{name:t.name,url:l,size:t.size}}));K(e=>[...e,...s])}catch(e){console.error("Ошибка добавления вложений к сообщению:",e),alert("Ошибка добавления вложений: ".concat(e instanceof Error?e.message:"Неизвестная ошибка"))}finally{e.target.value=""}},removeChatAttachment=e=>{K(t=>t.filter(t=>t.name!==e))},sendMessage=async()=>{if(!D.trim())return;let n={id:Date.now().toString(),role:"user",content:D,timestamp:new Date};T(e=>[...e,n]),I(""),O(!0);try{let n=D;if(_.length>0){let e=_.map(e=>"- ".concat(e.name,": ").concat(e.url)).join("\n");n+="\n\nВложения:\n".concat(e)}let a=e.html;e.html.includes("<!DOCTYPE html>")?e.css&&!e.html.includes("<style>")&&(a=e.html.replace("</head>","    <style>".concat(e.css,"</style>\n</head>"))):a='<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Email Template</title>\n    <style>'.concat(e.css,"</style>\n</head>\n<body>\n    ").concat(e.html,"\n</body>\n</html>");let s={message:n,emailHTML:a},o=localStorage.getItem("token");if(!o)throw Error("Необходима авторизация. Пожалуйста, войдите в систему.");let l=await fetch("".concat((0,w.l)(),"/api/sendMessageWithFile"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(s)});if(!l.ok){let e="Ошибка при отправке сообщения";400===l.status?e="Неверные параметры запроса":413===l.status?e="Слишком длинное сообщение (лимит 10KB)":500===l.status&&(e="Ошибка сервера при отправке сообщения");try{let t=await l.json();e=t.error||e}catch(e){}throw Error(e)}let r=await l.json();if(console.log("data",r),r.success){let e=r.emailHtml,n="",a=r.emailHtml.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);a&&(n=a.map(e=>{let t=e.match(/<style[^>]*>([\s\S]*?)<\/style>/i);return t?t[1].trim():""}).join("\n\n")),t(t=>({...t,html:e,css:n||t.css}))}let i={id:(Date.now()+1).toString(),role:"assistant",content:"Сообщение с HTML кодом успешно отправлено!\n\nСообщение: ".concat(JSON.stringify(r.message),"\n\nHTML код обработан и сохранен."),timestamp:new Date};T(e=>[...e,i])}catch(t){console.error("Error sending message:",t);let e={id:(Date.now()+1).toString(),role:"assistant",content:"Ошибка при отправке сообщения: ".concat(t instanceof Error?t.message:"Неизвестная ошибка"),timestamp:new Date};T(t=>[...t,e])}finally{O(!1),K([])}},copyFileUrl=e=>{let t=JSON.parse(localStorage.getItem("user")||"{}"),n=t.id||"default",a=t.token,s=a?"?token=".concat(encodeURIComponent(a)):"",o="".concat((0,w.l)(),"/api/assets/").concat(n,"/").concat(e).concat(s);navigator.clipboard.writeText(o).then(()=>{alert("URL файла скопирован в буфер обмена:\n".concat(o))}).catch(()=>{let e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("URL файла скопирован в буфер обмена:\n".concat(o))})};return(0,s.useEffect)(()=>{var e;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[E]),(0,s.useEffect)(()=>{let loadUploadedFiles=async()=>{try{P([])}catch(e){console.error("Error loading uploaded files:",e)}};loadUploadedFiles()},[]),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[calc(100vh-200px)]",children:[(0,a.jsxs)("div",{className:"bg-card border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>o("html"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("html"===n?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(i.Z,{className:"w-4 h-4 inline mr-2"}),"HTML"]}),(0,a.jsxs)("button",{onClick:()=>o("css"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("css"===n?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 inline mr-2"}),"CSS"]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{try{var e;null===(e=Y.current)||void 0===e||e.trigger("keyboard","undo",null)}catch(e){}},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Отменить",children:(0,a.jsx)(d.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{try{var e;null===(e=Y.current)||void 0===e||e.trigger("keyboard","redo",null)}catch(e){}},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Повторить",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{var e;null===(e=M.current)||void 0===e||e.click()},className:"p-2 text-green-600 hover:text-green-700 transition-colors",title:"Import email",children:(0,a.jsx)(h.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:uploadAssets,disabled:Z,className:"p-2 text-blue-600 hover:text-blue-700 transition-colors disabled:opacity-50",title:"Upload images and fonts to server",children:Z?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):(0,a.jsx)(u.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{t(N)},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Reset to default",children:(0,a.jsx)(x.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{let t='<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Email Template</title>\n    <style>'.concat(e.css,"</style>\n</head>\n<body>\n    ").concat(e.html,"\n</body>\n</html>"),n=new Blob([t],{type:"text/html"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="email-template.html",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Download email",children:(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("input",{ref:M,type:"file",accept:".html,.htm,.txt",onChange:e=>{var n;let a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!a)return;console.log("Importing file:",a.name,"Size:",a.size,"Type:",a.type);let s=new FileReader;s.onload=e=>{var n;let a=null===(n=e.target)||void 0===n?void 0:n.result;console.log("File content loaded, length:",a.length),console.log("Content preview:",a.substring(0,200)+"...");let s="",o=a.match(/<body[^>]*>([\s\S]*)<\/body>/i);if(o)console.log("Found body content, length:",(s=o[1].trim()).length);else{let e=a.replace(/<title[^>]*>.*?<\/title>/gi,"").replace(/<meta[^>]*>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").trim();e?console.log("Extracted content after meta tags, length:",(s=e).length):console.log("Loading entire file as HTML, length:",(s=a).length)}let l="",r=a.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);r&&console.log("Extracted CSS, length:",(l=r.map(e=>{let t=e.match(/<style[^>]*>([\s\S]*?)<\/style>/i);return t?t[1].trim():""}).join("\n\n")).length),s&&t(e=>({...e,html:s})),l&&t(e=>({...e,css:l}))},s.readAsText(a),e.target.value=""},className:"hidden"}),(0,a.jsx)("input",{ref:B,type:"file",accept:"image/*,.woff,.woff2,.ttf,.otf,.eot",multiple:!0,onChange:handleAssetsUpload,className:"hidden"}),(0,a.jsx)("div",{className:"h-[calc(100%-60px)]",children:(0,a.jsx)(r.ZP,{height:"100%",language:n,value:"html"===n?e.html:e.css,onChange:e=>handleEditorChange(e,n),onMount:e=>{Y.current=e},theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",lineNumbers:"on",roundedSelection:!1,scrollBeyondLastLine:!1,automaticLayout:!0}})})]}),(0,a.jsxs)("div",{className:"bg-card border rounded-lg p-4 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>C("preview"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("preview"===S?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(g.Z,{className:"w-4 h-4 inline mr-2"}),"Preview"]}),(0,a.jsxs)("button",{onClick:()=>C("chat"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("chat"===S?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 inline mr-2"}),"AI Chat"]}),(0,a.jsxs)("button",{onClick:()=>C("assets"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("assets"===S?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 inline mr-2"}),"Assets (",(null==F?void 0:F.length)||0,")"]})]}),"preview"===S&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>k("desktop"),className:"px-2 py-1 rounded text-xs font-medium transition-colors ".concat("desktop"===l?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:"Desktop"}),(0,a.jsx)("button",{onClick:()=>k("mobile"),className:"px-2 py-1 rounded text-xs font-medium transition-colors ".concat("mobile"===l?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:"Mobile"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:"preview"===S?(0,a.jsx)("div",{className:"h-full overflow-auto",children:(0,a.jsx)("div",{className:"mx-auto bg-white rounded-lg shadow-sm ".concat("mobile"===l?"max-w-md":"max-w-full"),children:(0,a.jsx)("iframe",{ref:z,className:"w-full h-[600px] border-0 rounded-lg",title:"Email Preview"})})}):"chat"===S?(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 space-y-3",children:[E.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg px-3 py-2 ".concat("user"===e.role?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp.toLocaleTimeString()})]})},e.id)),L&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-secondary text-secondary-foreground rounded-lg px-3 py-2",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,a.jsx)("div",{ref:J})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("textarea",{value:D,onChange:e=>I(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())},placeholder:"Задай вопрос о email шаблоне...",className:"flex-1 resize-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",rows:3}),_.length>0&&(0,a.jsx)("div",{className:"absolute -mt-12 right-24 left-0 px-1 overflow-x-auto",children:(0,a.jsx)("div",{className:"flex gap-2",children:_.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 bg-secondary rounded text-xs",children:[(0,a.jsx)("span",{className:"truncate max-w-[140px]",title:"".concat(e.name," • ").concat((e.size/1024).toFixed(1),"KB"),children:e.name}),(0,a.jsx)("button",{onClick:()=>removeChatAttachment(e.name),className:"text-muted-foreground hover:text-foreground",children:(0,a.jsx)(y.Z,{className:"w-3 h-3"})})]},e.name))})}),(0,a.jsx)("button",{onClick:()=>{var e;null===(e=H.current)||void 0===e||e.click()},className:"px-3 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 transition-colors",title:"Прикрепить файлы к сообщению",children:(0,a.jsx)(b.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:sendMessage,disabled:!D.trim()||L,className:"px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,a.jsx)(v.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("input",{ref:H,type:"file",multiple:!0,onChange:handleChatFilesSelect,className:"hidden"})]}):(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("button",{onClick:uploadAssets,disabled:Z,className:"w-full px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2",children:Z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Загрузка..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Загрузить файлы"})]})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:"Поддерживаются: изображения, шрифты (макс. 10MB)"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:F&&0!==F.length?(0,a.jsx)("div",{className:"space-y-2",children:null==F?void 0:F.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"w-4 h-4 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(e.size/1024).toFixed(1)," KB"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created).toLocaleDateString()}),(0,a.jsx)("button",{onClick:()=>copyFileUrl(e.name),className:"p-1 text-muted-foreground hover:text-foreground transition-colors",title:"Копировать URL файла",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]},t))}):(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(u.Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Нет загруженных файлов"}),(0,a.jsx)("p",{className:"text-sm",children:'Нажмите "Загрузить файлы" чтобы добавить ресурсы'})]})})]})})]})]})}var k=n(1097),S=n(7972);function Home(){let[e,t]=(0,s.useState)(null),[n,o]=(0,s.useState)(!0),tokenIsExpired=e=>{let t=JSON.parse(atob(e.split(".")[1]));return!!(t.exp&&Date.now()/1e3>=t.exp)};return(0,s.useEffect)(()=>{let e=localStorage.getItem("token");if(e&&!tokenIsExpired(e)){let e=JSON.parse(localStorage.getItem("user")||"{}");t(e.name)}o(!1)},[]),(0,a.jsx)("main",{className:"min-h-screen bg-background",children:(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Email Editor"}),(0,a.jsxs)(l(),{href:"/auth",className:"flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),n?(0,a.jsx)("span",{children:"Загрузка..."}):e?(0,a.jsx)("span",{children:e}):(0,a.jsx)("span",{children:"Войти"})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(EmailEditor,{}),!n&&!e&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm z-10 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 text-center shadow-lg",children:[(0,a.jsx)(S.Z,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Требуется авторизация"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Войдите в систему, чтобы использовать редактор"}),(0,a.jsxs)(l(),{href:"/auth",className:"inline-flex items-center space-x-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[(0,a.jsx)(k.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Войти"})]})]})})]})]})})}},1628:function(e,t,n){"use strict";n.d(t,{l:function(){return getBackendUrl}});let getBackendUrl=()=>"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"https://localhost:3001":"https://62.182.192.42:3001"}},function(e){e.O(0,[381,971,472,744],function(){return e(e.s=1287)}),_N_E=e.O()}]);