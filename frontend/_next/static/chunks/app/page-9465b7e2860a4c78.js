(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1287:function(e,t,n){Promise.resolve().then(n.bind(n,256))},256:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var a=n(7437),s=n(2265),o=n(837),l=n(2455),r=n(9409),i=n(1541),c=n(8438),d=n(5432),m=n(5817),u=n(9670),h=n(3966),x=n(6020),p=n(4266);let f={html:'<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Email Template</title>\n</head>\n<body style="margin: 0; padding: 0; font-family: Arial, sans-serif;">\n    <div class="email-container" style="max-width: 600px; margin: 0 auto; background-color: #ffffff;">\n        <header style="background-color: #4f46e5; color: white; padding: 20px; text-align: center;">\n            <h1 style="margin: 0; font-size: 24px;">Your Company</h1>\n        </header>\n        \n        <main style="padding: 30px 20px;">\n            <h2 style="color: #1f2937; margin-bottom: 20px;">Welcome!</h2>\n            <p style="color: #4b5563; line-height: 1.6; margin-bottom: 20px;">\n                This is a sample email template. You can edit the HTML and CSS to create your own design.\n            </p>\n            <div style="text-align: center; margin: 30px 0;">\n                <a href="#" style="background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">\n                    Call to Action\n                </a>\n            </div>\n        </main>\n        \n        <footer style="background-color: #f3f4f6; padding: 20px; text-align: center; color: #6b7280;">\n            <p style="margin: 0;">\xa9 2024 Your Company. All rights reserved.</p>\n        </footer>\n    </div>\n</body>\n</html>',css:"/* Email CSS Styles */\n.email-container {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n}\n\n.email-container h1 {\n    font-size: 24px;\n    font-weight: bold;\n    margin: 0;\n}\n\n.email-container h2 {\n    font-size: 20px;\n    font-weight: 600;\n    margin-bottom: 15px;\n}\n\n.email-container p {\n    margin-bottom: 15px;\n}\n\n.email-container a {\n    text-decoration: none;\n    color: #4f46e5;\n}\n\n.email-container a:hover {\n    text-decoration: underline;\n}\n\n/* Responsive design */\n@media (max-width: 600px) {\n    .email-container {\n        width: 100% !important;\n    }\n    \n    .email-container main {\n        padding: 20px 15px !important;\n    }\n}"};function EmailEditor(){let[e,t]=(0,s.useState)(f),[n,g]=(0,s.useState)("html"),[y,b]=(0,s.useState)("desktop"),[v,j]=(0,s.useState)("preview"),[w,N]=(0,s.useState)([{id:"1",role:"assistant",content:"Привет! Я помогу тебе создать email шаблон. Что хочешь изменить?",timestamp:new Date}]),[k,C]=(0,s.useState)(""),[E,S]=(0,s.useState)(!1),[L,D]=(0,s.useState)(!1),[R,T]=(0,s.useState)(!1),[P,A]=(0,s.useState)([]),U=(0,s.useRef)(null),Z=(0,s.useRef)(null),F=(0,s.useRef)(null),z=(0,s.useRef)(null),replaceRelativePaths=e=>e.replace(/src="(?!https?:\/\/)([^"]*\.(png|jpg|jpeg|gif|svg|webp|ico|woff|woff2|ttf|otf|eot))"/gi,'src="http://localhost:3001/api/assets/email-assets/$1"'),updatePreview=()=>{if(U.current){var t;let n=U.current,a=n.contentDocument||(null===(t=n.contentWindow)||void 0===t?void 0:t.document);if(a){let t=replaceRelativePaths(e.html);a.open(),a.write('\n          <!DOCTYPE html>\n          <html>\n          <head>\n            <meta charset="utf-8">\n            <meta name="viewport" content="width='.concat("mobile"===y?"375":"device-width",', initial-scale=1.0, user-scalable=no">\n            <style>').concat(e.css,"</style>\n          </head>\n          <body>\n            ").concat(t,"\n          </body>\n          </html>\n        ")),a.close()}}};(0,s.useEffect)(()=>{updatePreview()},[e]),(0,s.useEffect)(()=>{"preview"===v&&setTimeout(()=>{updatePreview()},100)},[v]);let handleEditorChange=(e,n)=>{void 0!==e&&t(t=>({...t,["html"===n?"html":"css"]:e}))},uploadAssets=()=>{var e;null===(e=F.current)||void 0===e||e.click()},handleAssetsUpload=async e=>{let t=e.target.files;if(t&&0!==t.length){T(!0);try{var n;let e=Array.from(t).map(async e=>{if(e.size>10485760)throw Error("Файл ".concat(e.name," слишком большой. Максимальный размер: 10MB"));let t=new FormData;t.append("file",e);let n=await fetch("http://localhost:3001/api/upload/email-assets",{method:"POST",body:t});if(!n.ok){let t=await n.json();throw Error(t.error||"Ошибка загрузки файла ".concat(e.name))}let a=await n.json();return{filename:e.name,uploadedFile:a.uploadedFile,folder:a.folder,files:a.files}}),a=await Promise.all(e);console.log("Успешно загружено ".concat(a.length," файлов:"),a),a.length>0&&A(a[a.length-1].files);let s=a.map(e=>e.filename).join(", ");alert("Успешно загружено ".concat(a.length," файлов:\n").concat(s,"\n\nПапка: ").concat(null===(n=a[0])||void 0===n?void 0:n.folder))}catch(e){console.error("Error uploading assets:",e),alert("Ошибка при загрузке файлов: ".concat(e instanceof Error?e.message:"Неизвестная ошибка"))}finally{T(!1),e.target.value=""}}},sendMessage=async()=>{if(!k.trim())return;let e={id:Date.now().toString(),role:"user",content:k,timestamp:new Date};N(t=>[...t,e]),C(""),S(!0),setTimeout(()=>{let e={id:(Date.now()+1).toString(),role:"assistant",content:"Я получил твое сообщение. Скоро здесь будет интеграция с AI для помощи в создании email шаблонов.",timestamp:new Date};N(t=>[...t,e]),S(!1)},1e3)},copyFileUrl=e=>{let t="http://localhost:3001/uploads/email-assets/".concat(e);navigator.clipboard.writeText(t).then(()=>{alert("URL файла скопирован в буфер обмена:\n".concat(t))}).catch(()=>{let e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("URL файла скопирован в буфер обмена:\n".concat(t))})};return(0,s.useEffect)(()=>{var e;null===(e=z.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[w]),(0,s.useEffect)(()=>{let loadUploadedFiles=async()=>{try{A([])}catch(e){console.error("Error loading uploaded files:",e)}};loadUploadedFiles()},[]),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[calc(100vh-200px)]",children:[(0,a.jsxs)("div",{className:"bg-card border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>g("html"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("html"===n?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(l.Z,{className:"w-4 h-4 inline mr-2"}),"HTML"]}),(0,a.jsxs)("button",{onClick:()=>g("css"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("css"===n?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(r.Z,{className:"w-4 h-4 inline mr-2"}),"CSS"]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{var e;null===(e=Z.current)||void 0===e||e.click()},className:"p-2 text-green-600 hover:text-green-700 transition-colors",title:"Import email",children:(0,a.jsx)(i.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:uploadAssets,disabled:R,className:"p-2 text-blue-600 hover:text-blue-700 transition-colors disabled:opacity-50",title:"Upload images and fonts to server",children:R?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):(0,a.jsx)(c.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{t(f)},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Reset to default",children:(0,a.jsx)(d.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>{let t='<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Email Template</title>\n    <style>'.concat(e.css,"</style>\n</head>\n<body>\n    ").concat(e.html,"\n</body>\n</html>"),n=new Blob([t],{type:"text/html"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download="email-template.html",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},className:"p-2 text-muted-foreground hover:text-foreground transition-colors",title:"Download email",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("input",{ref:Z,type:"file",accept:".html,.htm,.txt",onChange:e=>{var n;let a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!a)return;console.log("Importing file:",a.name,"Size:",a.size,"Type:",a.type);let s=new FileReader;s.onload=e=>{var n;let a=null===(n=e.target)||void 0===n?void 0:n.result;console.log("File content loaded, length:",a.length),console.log("Content preview:",a.substring(0,200)+"...");let s="",o=a.match(/<body[^>]*>([\s\S]*)<\/body>/i);if(o)console.log("Found body content, length:",(s=o[1].trim()).length);else{let e=a.replace(/<title[^>]*>.*?<\/title>/gi,"").replace(/<meta[^>]*>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").trim();e?console.log("Extracted content after meta tags, length:",(s=e).length):console.log("Loading entire file as HTML, length:",(s=a).length)}let l="",r=a.match(/<style[^>]*>([\s\S]*?)<\/style>/gi);r&&console.log("Extracted CSS, length:",(l=r.map(e=>{let t=e.match(/<style[^>]*>([\s\S]*?)<\/style>/i);return t?t[1].trim():""}).join("\n\n")).length),s&&t(e=>({...e,html:s})),l&&t(e=>({...e,css:l}))},s.readAsText(a),e.target.value=""},className:"hidden"}),(0,a.jsx)("input",{ref:F,type:"file",accept:"image/*,.woff,.woff2,.ttf,.otf,.eot",multiple:!0,onChange:handleAssetsUpload,className:"hidden"}),(0,a.jsx)("div",{className:"h-[calc(100%-60px)]",children:(0,a.jsx)(o.ZP,{height:"100%",language:n,value:"html"===n?e.html:e.css,onChange:e=>handleEditorChange(e,n),theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,wordWrap:"on",lineNumbers:"on",roundedSelection:!1,scrollBeyondLastLine:!1,automaticLayout:!0}})})]}),(0,a.jsxs)("div",{className:"bg-card border rounded-lg p-4 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>j("preview"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("preview"===v?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 inline mr-2"}),"Preview"]}),(0,a.jsxs)("button",{onClick:()=>j("chat"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("chat"===v?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 inline mr-2"}),"AI Chat"]}),(0,a.jsxs)("button",{onClick:()=>j("assets"),className:"px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("assets"===v?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 inline mr-2"}),"Assets (",(null==P?void 0:P.length)||0,")"]})]}),"preview"===v&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>b("desktop"),className:"px-2 py-1 rounded text-xs font-medium transition-colors ".concat("desktop"===y?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:"Desktop"}),(0,a.jsx)("button",{onClick:()=>b("mobile"),className:"px-2 py-1 rounded text-xs font-medium transition-colors ".concat("mobile"===y?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"),children:"Mobile"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:"preview"===v?(0,a.jsx)("div",{className:"h-full overflow-auto",children:(0,a.jsx)("div",{className:"mx-auto bg-white rounded-lg shadow-sm ".concat("mobile"===y?"max-w-md":"max-w-full"),children:(0,a.jsx)("iframe",{ref:U,className:"w-full h-[600px] border-0 rounded-lg",title:"Email Preview"})})}):"chat"===v?(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 space-y-3",children:[w.map(e=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg px-3 py-2 ".concat("user"===e.role?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground"),children:[(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp.toLocaleTimeString()})]})},e.id)),E&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-secondary text-secondary-foreground rounded-lg px-3 py-2",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-current rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),(0,a.jsx)("div",{ref:z})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("textarea",{value:k,onChange:e=>C(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendMessage())},placeholder:"Задай вопрос о email шаблоне...",className:"flex-1 resize-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",rows:3}),(0,a.jsx)("button",{onClick:sendMessage,disabled:!k.trim()||E,className:"px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,a.jsx)(x.Z,{className:"w-4 h-4"})})]})]}):(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("button",{onClick:uploadAssets,disabled:R,className:"w-full px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2",children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:"Загрузка..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Загрузить файлы"})]})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:"Поддерживаются: изображения, шрифты (макс. 10MB)"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:P&&0!==P.length?(0,a.jsx)("div",{className:"space-y-2",children:null==P?void 0:P.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary/10 rounded flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-4 h-4 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(e.size/1024).toFixed(1)," KB"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.created).toLocaleDateString()}),(0,a.jsx)("button",{onClick:()=>copyFileUrl(e.name),className:"p-1 text-muted-foreground hover:text-foreground transition-colors",title:"Копировать URL файла",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]},t))}):(0,a.jsxs)("div",{className:"text-center text-muted-foreground py-8",children:[(0,a.jsx)(c.Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Нет загруженных файлов"}),(0,a.jsx)("p",{className:"text-sm",children:'Нажмите "Загрузить файлы" чтобы добавить ресурсы'})]})})]})})]})]})}function Home(){return(0,a.jsx)("main",{className:"min-h-screen bg-background",children:(0,a.jsxs)("div",{className:"container mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-center mb-8",children:"Email Editor"}),(0,a.jsx)(EmailEditor,{})]})})}}},function(e){e.O(0,[969,971,472,744],function(){return e(e.s=1287)}),_N_E=e.O()}]);